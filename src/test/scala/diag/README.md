# デバッグ用便利モジュール

## 埋め込みロジック・プローブ

GOWIN EDAに付属のGOWIN Analyzer Oscilloscope (GAO) がTang Nano 9K + Linuxの環境でまともに使えないので、代わりとなる埋め込みロジック・プローブモジュールを用意した。

GAOはJTAG経由でデータのやり取りをするが、ここで使用する埋め込みロジックプローブは、UARTでデータを垂れ流すだけである。

![構成](probe.drawio.svg)

### フレーム・フォーマット

8bitのUARTで信号を送るため、信号データを7bit単位で表現し、フレーム化のマーカーとして フレーム開始 (SOF) = 0x80, フレーム終了 (EOF) = 0x81 を用いる。

信号データはLSb firstで7bit単位で送信される。信号データのバイトは最上位ビット(7bit目)は常に0とする。7bitに満たない場合は上位ビットは0で埋められる。
例えば、測定したビット列が `9'b1_1111_1111` だった場合、 `8'b0111_1111 8'b0000_0011` が信号データとなる。

さらにSOF, EOFを付加して、フレームのバイト列は16進数で `80 7f 03 81` となる。

### 受信プログラム

ホストPC用の受信プログラムは `tool/probedec` ディレクトリに格納されている。Rustで記述しているので、Rustのビルド環境が必要となる。